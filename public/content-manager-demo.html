<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–Ω—Ç–µ–Ω—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ - –ü—Ä–∏–º–µ—Ä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: rgba(93, 140, 48, 0.1);
            border: 1px solid rgba(93, 140, 48, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        h1 {
            color: #7EB342;
            margin-bottom: 10px;
        }

        .info-box {
            background: rgba(93, 140, 48, 0.05);
            border-left: 4px solid #5D8C30;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
        }

        .pages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .page-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(93, 140, 48, 0.3);
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .page-card:hover {
            background: rgba(93, 140, 48, 0.15);
            border-color: #7EB342;
            transform: translateY(-2px);
        }

        .page-card h3 {
            color: #7EB342;
            margin-bottom: 10px;
        }

        .page-card p {
            color: #aaa;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .page-actions {
            display: flex;
            gap: 10px;
        }

        button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-edit {
            background: #5D8C30;
            color: white;
        }

        .btn-edit:hover {
            background: #7EB342;
        }

        .btn-view {
            background: rgba(93, 140, 48, 0.2);
            color: #7EB342;
            border: 1px solid #7EB342;
        }

        .btn-view:hover {
            background: #7EB342;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            color: #7EB342;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #333;
            border-radius: 4px;
            color: #fff;
            font-family: inherit;
            font-size: 14px;
        }

        textarea {
            resize: vertical;
            min-height: 300px;
            font-family: 'Courier New', monospace;
        }

        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: #7EB342;
            background: rgba(93, 140, 48, 0.1);
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-save {
            background: #5D8C30;
            color: white;
            flex: 1;
        }

        .btn-save:hover {
            background: #7EB342;
        }

        .btn-close {
            background: #333;
            color: #aaa;
            flex: 1;
        }

        .btn-close:hover {
            background: #444;
        }

        .status-message {
            padding: 10px 15px;
            border-radius: 4px;
            margin-top: 10px;
            display: none;
        }

        .status-message.success {
            display: block;
            background: rgba(93, 140, 48, 0.3);
            border-left: 4px solid #5D8C30;
            color: #7EB342;
        }

        .status-message.error {
            display: block;
            background: rgba(220, 53, 69, 0.3);
            border-left: 4px solid #dc3545;
            color: #ff7f82;
        }

        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(126, 179, 66, 0.3);
            border-radius: 50%;
            border-top-color: #7EB342;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>üìñ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º —Å—Ç—Ä–∞–Ω–∏—Ü</h1>
            <p>–°–∏—Å—Ç–µ–º–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</p>
            <div class="info-box">
                <strong>INFO:</strong> –≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–¥–º–∞–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü
                —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL
                –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ –ø–æ—Å–µ—â–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
            </div>
        </header>

        <div id="pages-container" class="pages-grid">
            <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                <div class="loader" style="display: inline-block;"></div>
                <p style="margin-top: 20px; color: #aaa;">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü...</p>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</h2>
            <form id="edit-form" onsubmit="return false;">
                <div class="form-group">
                    <label for="page-title">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                    <input type="text" id="page-title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫">
                </div>

                <div class="form-group">
                    <label for="page-content">HTML –ö–æ–Ω—Ç–µ–Ω—Ç</label>
                    <textarea id="page-content" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ HTML –∫–æ–Ω—Ç–µ–Ω—Ç –∑–¥–µ—Å—å..."></textarea>
                </div>

                <div class="status-message" id="edit-status"></div>

                <div class="modal-actions">
                    <button type="button" class="btn-save" onclick="savePageContent()">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                    <button type="button" class="btn-close" onclick="closeEditModal()">
                        ‚úï –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
    <script src="content-manager.js"></script>
    <script src="content-editor.js"></script>

    <script>
        let currentEditPage = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä
        const editor = new ContentEditor({
            isAdmin: true // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç–æ–∫–µ–Ω
        });

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        async function loadPages() {
            try {
                const pages = await editor.getAllPages();

                if (!pages || pages.length === 0) {
                    document.getElementById('pages-container').innerHTML =
                        '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #aaa;">' +
                        '–ù–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è<br>' +
                        '–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ: npm run init-content' +
                        '</div>';
                    return;
                }

                const html = pages.map(page => `
                    <div class="page-card">
                        <h3>${page.page_name}</h3>
                        <p>
                            <strong>–í–µ—Ä—Å–∏—è:</strong> ${page.version}<br>
                            <strong>–°—Ç–∞—Ç—É—Å:</strong> ${page.is_active ? '‚úì –ê–∫—Ç–∏–≤–Ω–∞' : '‚úó –ù–µ–∞–∫—Ç–∏–≤–Ω–∞'}<br>
                            <strong>–û–±–Ω–æ–≤–ª–µ–Ω–∞:</strong> ${new Date(page.updated_at).toLocaleDateString('ru-RU')}
                        </p>
                        <div class="page-actions">
                            <button class="btn-edit" onclick="openEditModal('${page.page_name}')">
                                ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <button class="btn-view" onclick="viewPagePreview('${page.page_name}')">
                                üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä
                            </button>
                        </div>
                    </div>
                `).join('');

                document.getElementById('pages-container').innerHTML = html;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü:', error);
                document.getElementById('pages-container').innerHTML =
                    '<div style="grid-column: 1/-1; color: #ff7f82;">–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü</div>';
            }
        }

        // –û—Ç–∫—Ä—ã—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä
        async function openEditModal(pageName) {
            currentEditPage = pageName;
            const pageData = await editor.getPageForEditing(pageName);

            if (pageData) {
                document.getElementById('page-title').value = pageData.title || '';
                document.getElementById('page-content').value = pageData.content || '';
                document.getElementById('edit-modal').classList.add('active');
                document.getElementById('edit-status').className = 'status-message';
            }
        }

        // –ó–∞–∫—Ä—ã—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä
        function closeEditModal() {
            document.getElementById('edit-modal').classList.remove('active');
            currentEditPage = null;
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
        async function savePageContent() {
            if (!currentEditPage) return;

            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚è≥ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
            btn.disabled = true;

            const title = document.getElementById('page-title').value;
            const content = document.getElementById('page-content').value;

            const result = await editor.savePageContent(currentEditPage, {
                title: title || null,
                content: content
            });

            if (result) {
                showStatus('edit-status', '‚úì –ö–æ–Ω—Ç–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
                setTimeout(() => {
                    closeEditModal();
                    loadPages();
                }, 1500);
            } else {
                showStatus('edit-status', '‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞', 'error');
            }

            btn.textContent = originalText;
            btn.disabled = false;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status-message ${type}`;
        }

        // –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function viewPagePreview(pageName) {
            const url = `/${pageName}.html`;
            window.open(url, '_blank');
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
        document.getElementById('edit-modal').addEventListener('click', (e) => {
            if (e.target.id === 'edit-modal') {
                closeEditModal();
            }
        });

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
        loadPages();
    </script>
</body>

</html>